// // This is your Prisma schema file,
// // learn more about it in the docs: https://pris.ly/d/prisma-schema

// // Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// // Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

// generator client {
//   provider = "prisma-client-js"
// }

// datasource db {
//   provider = "mysql"
//   url      = env("DATABASE_URL")
// }

// model Department {
//   id      Int      @id @default(autoincrement())
//   name    String   @unique
//   doctors Doctor[]
// }

// model Doctor {
//   id               Int                  @id @default(autoincrement())
//   name             String
//   email            String
//   phone_number     String
//   qualification    String
//   departmentId     Int
//   departmentName   String               @default("Unknown")
//   department       Department           @relation(fields: [departmentId], references: [id])
//   availableFrom    String? // New field for available timing
//   slotDuration     Int? // New field for slot duration
//   createdAt        DateTime             @default(now())
//   updatedAt        DateTime             @updatedAt
//   availability     DoctorAvailability[] @relation(name: "DoctorToAvailability")
//   unavailableDates UnavailableDates[]   @relation(name: "DoctorToUnavailableDate")
//   Appointment      Appointment[]
//   bookedSlots BookedSlot[] @relation(name: "DoctorToBookedSlot")

// }

// model DoctorAvailability {
//   id            Int    @id @default(autoincrement())
//   doctorId      Int
//   day           String // e.g., "mon", "tue", etc.
//   availableFrom String // e.g., "09:00-11:00"
//   slotDuration  Int    @default(20) // Slot duration in minutes

//   // Relation to Doctor
//   doctor Doctor @relation(fields: [doctorId], references: [id], onDelete: Cascade, name: "DoctorToAvailability")
// }

// model UnavailableDates {
//   id       Int      @id @default(autoincrement())
//   doctorId Int
//   date     DateTime

//   doctor Doctor @relation(fields: [doctorId], references: [id], onDelete: Cascade, name: "DoctorToUnavailableDate")
// }

// model Appointment {
//   id          Int               @id @default(autoincrement())
//   patientName String
//   phoneNumber String
//   email       String
//   doctorId    Int
//   doctor      Doctor            @relation(fields: [doctorId], references: [id])
//   doctorName  String
//   department  String
//   date        String
//   time        String
//   requestVia  String?
//   smsSent     Boolean?          @default(false)
//   status      AppointmentStatus @default(pending)
//   created_at  DateTime          @default(now())
//   updated_at  DateTime          @updatedAt

//   @@map("appointments")
// }

// enum AppointmentStatus {
//   pending
//   confirmed
//   cancelled
// }

// model BookedSlot {
//   id          Int      @id @default(autoincrement())
//   doctorId    Int
//   doctor      Doctor   @relation(fields: [doctorId], references: [id], onDelete: Cascade)
//   date        String   // Store the date as a string (e.g., 'YYYY-MM-DD')
//   time        String   // The booked time slot (e.g., '09:00-09:20')
//   createdAt   DateTime @default(now())
// }

// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Department {
  id      Int      @id @default(autoincrement())
  name    String   @unique
  doctors Doctor[]
}

model Doctor {
  id               Int                  @id @default(autoincrement())
  name             String
  email            String
  phone_number     String
  qualification    String
  departmentId     Int
  departmentName   String               @default("Unknown")
  department       Department           @relation(fields: [departmentId], references: [id])
  availableFrom    String? // New field for available timing
  slotDuration     Int? // New field for slot duration
  createdAt        DateTime             @default(now())
  updatedAt        DateTime             @updatedAt
  availability     DoctorAvailability[] @relation(name: "DoctorToAvailability")
  unavailableDates UnavailableDates[]   @relation(name: "DoctorToUnavailableDate")
  appointments     Appointment[] // Fixed field name to follow naming convention
  bookedSlots      BookedSlot[]         @relation(name: "DoctorToBookedSlot")
}

model DoctorAvailability {
  id            Int    @id @default(autoincrement())
  doctorId      Int
  day           String // e.g., "mon", "tue", etc.
  availableFrom String // e.g., "09:00-11:00"
  slotDuration  Int    @default(20) // Slot duration in minutes

  // Relation to Doctor
  doctor Doctor @relation(fields: [doctorId], references: [id], onDelete: Cascade, name: "DoctorToAvailability")
}

model UnavailableDates {
  id       Int      @id @default(autoincrement())
  doctorId Int
  date     DateTime

  doctor Doctor @relation(fields: [doctorId], references: [id], onDelete: Cascade, name: "DoctorToUnavailableDate")
}

model Appointment {
  id          Int               @id @default(autoincrement())
  patientName String
  phoneNumber String
  email       String
  doctorId    Int
  doctor      Doctor            @relation(fields: [doctorId], references: [id])
  doctorName  String
  department  String
  date        String
  time        String
  requestVia  String?
  smsSent     Boolean?          @default(false)
  status      AppointmentStatus @default(pending)
  created_at  DateTime          @default(now())
  updated_at  DateTime          @updatedAt

  @@map("appointments")
}

enum AppointmentStatus {
  pending
  confirmed
  cancelled
}

model BookedSlot {
  id        Int      @id @default(autoincrement())
  doctorId  Int
  doctor    Doctor   @relation(fields: [doctorId], references: [id], onDelete: Cascade, name: "DoctorToBookedSlot") // Added correct relation name
  date      String // Store the date as a string (e.g., 'YYYY-MM-DD')
  time      String // The booked time slot (e.g., '09:00-09:20')
  createdAt DateTime @default(now())
}
